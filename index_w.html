<!DOCTYPE html>
<html>
<meta charset="utf-8">

<body style="background:darkgrey">
<div id="Parent">

<div id="pie-chart" style=" height:100;">
<button onclick="repeat()" class="absolute2" >Start</button>
<div id="year-text" class="absolute1"></div>
</div>
<div id="line-chart" style="position:absolute; top:100px; right:10px; width:800px;height:600px;"></div>

<div id="Line-bar-charts" >
<div class="buttons" ></div>
<div class="chart1" ></div>

<div id="svg-chcharts">
<svg id="ch_chart" style="width:320px;height:400px;"></svg>
<svg id="ch_chart2" style="width:320px;height:400px;"></svg>
<svg id="ch_chart3" style="width:320px;height:400px;"></svg>
</div>
</div>

<div>
<div id="sunburst"></div>
<div id="heatmap"></div>
</div>

<div id="slopegraph2">
<div class="selectmenu_start"></div>
<div class="selectmenu_end"></div>
</div>


<div id="pcoordinates" >
<div id="example" class="parcoords"style="width:960px;height:400px;">
<div class="pcoord-title"></div>
<div class="selectmenu_year"></div>
<div class="selectmenu_country"></div>
</div>
</div>

<div id="Choropleth">
<div id="container" style="position: relative; width:800px;height:600px;"></div>
<div id="bubble"></div>
</div>

<div id="Choropleth2">
<div id="container2" style="position: relative; width:800px;height:600px;"></div>
<div id="scatter2"></div>
</div>

<div class="choice_buttons" style="position: relative; top:2000px; left:-10px; width: 200px; height: 400px;"></div>
<div class="whisker" style="position: relative; top:2100px; left:200px "></div>

<div id="sentiment" style="position: relative; top:2000px; left:300px">
<div class="text_buttons" style="position: relative;  left:-90px"></div>
<div class="svg-sentiment" style="position: relative;height:900px; width:1000px;top:-10px; left:10px "></div>
</div>

<div id="area" style="position: relative; top:2800px; left:5px"></div>

</div>

<style>
.pool {
    fill: #3db1ff;
    stroke: #4f4f4f;
}
</style>

<style>
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.box {
  font: 10px sans-serif;
}

.box line,
.box rect,
.box circle {
  fill: steelblue;
  stroke: #000;
  stroke-width: 1px;
}

.box .center {
  stroke-dasharray: 3,3;
}

.box .outlier {
  fill: none;
  stroke: #000;
}

.axis {
  font: 12px sans-serif;
}
 
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
 
.xaxis path { 
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
</style>


<style type='text/css'>
        line.slope-line{
            stroke:green
        }
        text.slope-label{
            fill:blue;
            font: 15px Arial;
        }
    </style>
	
<style>
.button text {
  font-size: 20px;
  fill: #eee;
  pointer-events: none;
  text-anchor: middle;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 120px;					
    height: 50px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightgreen;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}

div.absolute1 {
    position: absolute;
    top: 10px;
    right: 650px;
    width: 100px;
    height: 20px;
    border: 3px solid #73AD21;
}

.absolute2 {
    position: absolute;
    top: 50px;
    right: 850px;
    
}
</style>

<style>
    body   { color: #444; background: #f3f3f3; font: normal 12px "Adobe Garamond Pro", "Palatino", serif; margin: 2em; }
    header { margin: 0 0 20px 220px; border-bottom: 1px solid #6c6c6c; width: 360px; position: relative; }
    h1     { font-size: 16px; font-weight: normal; text-shadow: #fff 0 1px 0; margin: 0 0 0 0; padding: 0; }
    small  { color: #a3a3a3; font-size: 10px; position: absolute; top: 0.6em; right: 0;}
    a      { color: #a3a3a3; }
    text.label { fill: #444; }
    text.label.start { text-anchor: end; }
    line.slope { stroke: #444; stroke-width: 1; }
    .missing text.label { display: none; }
    .missing line.slope { display: none; }
    .over text.label { fill: #bb2629; font-size: 14px !important; font-weight: bold; }
    .over line.slope { stroke: #bb2629; stroke-width: 2; }
  </style>

<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
<script>
var d3_2=d3;
</script>

 

<script src="https://d3js.org/d3.v4.min.js"></script>

<script>
var new_d3=d3;
</script>

<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
<script>
var d3_2=d3;
</script>


<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
var old_d3=d3;
</script>


<script src="http://code.jquery.com/jquery-2.1.4.min.js" charset="utf-8"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
<script src="https://dc-js.github.io/dc.js/js/dc.js"></script>
 <script type='text/javascript' src="./js/slopegraph.js"></script>
 <script type='text/javascript' src="./js/d3.parcoords.js"></script>
 <script src="./js/d3.svg.multibrush.js"></script>
 <script src="./js/box.js"></script>
 <script src="./js/circularHeatChart.js"></script>
 
 <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>

<script src="./js/datamaps.world.min.js"></script>
<script src="node_modules/datamaps/dist/datamaps.world.min.js"></script>
<script src="node_modules/datamaps/dist/datamaps.usa.min.js"></script>
 
 <link rel="stylesheet" type="text/css" href="./js/d3.parcoords.css">
 <link rel="stylesheet" type="text/css" href="./js/style.css">
 <link rel="stylesheet" type="text/css" href="./js/sequences.css"/>
  

<style>
node-text {
  font: 24px "Helvetica Neue", Helvetica, Arial, sans-serif;
  text-anchor: middle;
  pointer-events: none;
}

node-circle {
  fill: #ccc;
}

.node:hover circle {
  fill: orange;
}
 </style>
 
 <style>
      .heat-box {
        stroke: #E6E6E6;
        stroke-width: 2px;
      }
    </style>
 
<script type="text/javascript">
 var d3=old_d3;
 //console.log(JSON.stringify(new_d3));
 var years_list;
 var d3_1=new_d3;
 
 function rangefn(start, stop, step){
  var a=[start], b=start;
  while(b<stop){b+=step;a.push(b)}
  return a;
};
//////////////////////////////////////////////////////////////////////////////////////
//Slopegraph2
$.get('http://localhost:3300/UFOreports', function(data) {
           var years_list=data;
		   years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);});
			 
		   
 var sel_start=d3.select(".selectmenu_start")
            .append("select")
            .attr("class","sel")
	     	.on("change",onchange_start);
              		
   var options_start = sel_start.selectAll(".option")
	            .data(years_list).enter()
	            .append("option")
				.attr("class","option")
	            .text(function (d) { return d; });
				
var sel_end=d3.select(".selectmenu_end")
            .append("select")
            .attr("class","sel")
	     	.on("change",onchange_end);
              		
   var options_end = sel_end.selectAll(".option")
	            .data(years_list).enter()
	            .append("option")
				.attr("class","option")
	            .text(function (d) { return d; });
                   
var years_sel={};
years_sel.start=1910;
years_end=2014;
				
function onchange_start(){
   var selectedIndex = sel_start.property('selectedIndex'),
       selected_data          = options_start[0][selectedIndex].__data__;
   console.log(selected_data);
   years_sel.start=selected_data;
   
 }	   
 
 function onchange_end(){
   var selectedIndex = sel_end.property('selectedIndex'),
       selected_data2          = options_end[0][selectedIndex].__data__;
   console.log(selected_data2);
  years_sel.end=selected_data2;
  
  d3.select("#slopegraph2").select(".sg-chart").remove();
  if(years_sel.start< years_sel.end)
    getStats_SG2(years_sel.start,years_sel.end);
 }	   

 });
 
function getStats_SG2(year1,year2){
 $.get('http://localhost:3300/UFOreports', function(data) {
           var years_list=data;
		   
 
 
	     var data = {};	
                 //  	data.number=num;
				 data.y1=year1;
				 data.y2-year2;
				 
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_slopegraph2',						
                        success: function(resp) {
                            console.log('success');					
							draw_slopegraph2_chart(resp,year1,year2);						
							
                        }
                    });    	  
	  })
}	  
 
 
 getStats_SG2(1910,2012);

 function draw_slopegraph2_chart(csv,year1,year2)
 {
 var countries=["ca","us","gb","au"];

  var data      = csv
                      .map( function(d) {
					    if(d[year1.toString()] == null)
						  d[year1.toString()]=0;
						if(d[year2.toString()] == null)
						  d[year2.toString()]=0; 
						  
                        var r = {
                          label: d.Country,
                          start:+d[year1.toString()],
                          end:   +d[year2.toString()]
						  
                        };
                     
                        return r;
                      });
					  
					  var start=year1;var end=year2;
 
  var  values    = data
                      .map( function(d) { return d3.round(d.start, 1); })
                      .filter( function(d) { return d; } )
                      .concat(
                        data
                          .map( function(d) { return d3.round(d.end, 1); } )
                          .filter( function(d) { return d; } )
                      )
                      .sort()
                      .reverse(),
        // Return true for countries without start/end values
        missing   = function(d) { return !d.start || !d.end; },
        // Format values for labels
        label_format = function(value) { return d3.format(".1f")(d3.round(value, 1)); },
        font_size = 12,
        margin    = 20,
        width     = 800,
        height    = countries.length * font_size*1.5 + margin,
        chart     = d3.select("#slopegraph2").append("svg")
                   .attr("width",  width)
                   .attr("height", height)
				   .attr("class","sg-chart");
				   
				   console.log(JSON.stringify(data));
				   
				   var slope = d3.scale.ordinal()
                  .domain(values)
                  .rangePoints([margin, height]);
    
    // Countries
    var country = chart.selectAll("g.country")
                    .data( data )
                    .enter()
                    .append("g")
                    .attr("class", "country")
                    //.classed("missing", function(d) { return missing(d); });
    country
      .on("mouseover", function(d,i) { return d3.select(this).classed("over", true); })
      .on("mouseout",  function(d,i) { return d3.select(this).classed("over", false); });
    // ** Left column
    country
      .append("text")
      .classed("label start", true)
      .attr("x", 200)
      .attr("y", function(d,i) { var rounded = d3.round(d.start, 1); return slope(rounded) })
      .attr("xml:space", "preserve")
      .style("font-size", font_size)
      .text(function(d) { return d.label+ "   " + label_format(d.start); });
    // ** Right column
    country
      .append("text")
      .classed("label end", true)
      .attr("x", width-200)
      // .attr("y", function(d,i) { return slope(d.end); })
      .attr("y", function(d,i) { var rounded = d3.round(d.end, 1); return slope(rounded) })
      .attr("xml:space", "preserve")
      .style("font-size", font_size)
      .text(function(d) { return label_format(d.end) + "   " + d.label; });
    // ** Slope lines
    country
      .append("line")
      .classed("slope", function(d) { return d.start || d.end; })
      .attr("x1", 210)
      .attr("x2", width-210)
      .attr("y1", function(d,i) {
        var rounded = d3.round(d.start, 1)
        return d.start || d.end ? slope(rounded) - font_size/2 + 2 : null;
      })
      .attr("y2", function(d,i) {
        var rounded = d3.round(d.end, 1)
        return d.end || d.end ? slope(rounded) - font_size/2 + 2 : null;
      }); 
 return chart;
 }	
	
///////////////////////////////////////////////////////////////////////////////////////
//Draw sunburst chart for months--time--(duration?) and more.
   // set here your svg properties
   getStats_sb(1910);
   getStats_heatmap(1910);
   
  function getStats_sb(year){
	  $.get('http://localhost:3300/UFOreports', function(data) {
	     var data = {};	
                 //data.number=num;
				 data.Year=year;
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_sunburst',						
                        success: function(resp) {
                            console.log('success');					
							draw_sunburst_chart(resp);						
							
                        }
                    });

     	 }) 
	  }	  

function getStats_heatmap(year){
	     var data = {};	
                 //data.number=num;
				 data.Year=year;
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_heatmap',						
                        success: function(resp) {
                            console.log('success');					
							draw_heatmap_chart(resp);									
                        }
                    });	  
	  }	  


	  
function rangefn(start, stop, step){
  var a=[start], b=start;
  while(b<stop){b+=step;a.push(b)}
  return a;
};

function draw_heatmap_chart(experiments)
{
var chart = dc.heatMap("#heatmap");
var ndx    = crossfilter(experiments),
      runDim = ndx.dimension(function(d) { return [d.Run, +d.Expt]; }),
      runGroup = runDim.group().reduceSum(function(d) { return +d.Speed; });
 
 chart
    .width(42 * 30 + 80)
    .height(45 * 5 + 40)
    .dimension(runDim)
    .group(runGroup)
    .keyAccessor(function(d) { return d.key[0]; })
    .valueAccessor(function(d) { return +d.key[1]; })
    .colorAccessor(function(d) { return +d.value; })
    .title(function(d) {
        return "Run:   " + d.key[0] + "\n" +
               "Expt:  " + d.key[1] + "\n" +
               "Speed: " + ( d.value) + " km/s";})
    .colors(d3.scale.category20b())
    .calculateColorDomain()
	.legend(dc.legend().x(25).y(25))
	
  chart.render();

}



function draw_sunburst_chart(json){
var w = 300,
    h = 300,
    r = Math.min(w, h)/2 ,
    color = d3.scale.category20b();

var vis = d3.select("#sunburst").append("svg:svg")
    .attr("width", w)
    .attr("height", h)
  .append("svg:g")
    .attr("transform", "translate(" + w / 2 + "," + h / 2 + ")");

var partition = d3.layout.partition()
    .sort(null)
    .size([2 * Math.PI, r * r])
    .children(function(d) { return isNaN(d.value) ? d3.entries(d.value) : null; })
    .value(function(d) { return d.value; });

var arc = d3.svg.arc()
    .startAngle(function(d){return d.x; })
    .endAngle(function(d) { return d.x + d.dx; })
    .innerRadius(function(d) { return Math.sqrt(d.y); })
    .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });

  //d3.json("readme.json", function(json) {
  //console.log("Json: ",JSON.stringify(json));
  var g = vis.data(d3.entries(json)).selectAll("g")
      .data(partition)
    .enter().append("svg:g")
      .attr("display", function(d) { return d.depth ? null : "none"; }); // hide inner ring

  g.append("svg:path")
      .attr("d", arc)
      .attr("stroke", "#fff")
      .attr("fill", function(d) {//console.log(d); 
	                        return color(d.value); })
      .attr("fill-rule", "evenodd");
	  
  g.append("svg:text")
      .attr("transform", function(d) { return "rotate(" + (d.x + d.dx / 2 - Math.PI / 2) / Math.PI * 180 + ")"; })
      .attr("x", function(d) { return Math.sqrt(d.y); })
      .attr("dx", "5") // margin
      .attr("dy", ".35em") // vertical-align
      .text(function(d) { return d.key; });
//});
}
	
 
//////////////////////////////////////////////////////////////////////////////////////
//Circular HEat chart.
//Circular heat chart --month country

function getStats_chChart3(Year){
$.get('http://localhost:3300/UFOreports', function(data) {
        years_list=data;
		years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);});
			 
  // set here your svg properties
                    var data = {};	
                    data.Year=Year;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_chChart3',						
                        success: function(resp) {
                            console.log('success');
							//console.log(JSON.stringify(resp));
							var radlabels=["January", "February", "March", "April", "May", "June", "July","August","September","October","November","December"];
							var seglabels=["ca","gb","us","au"];
							var clabels=["white","red"];
							var nseg=4;
							draw_circularHeat_chart(resp,radlabels,seglabels,clabels,nseg,"#ch_chart3");						
							
                        }
                    });

         });     

}

getStats_chChart3(2012);

//Circular HEat chart. --month sentiment
function getStats_chChart2(Year){
$.get('http://localhost:3300/UFOreports', function(data) {
        years_list=data;
		years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);});
			 
  // set here your svg properties
                    var data = {};	
                    data.Year=Year;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_chChart2',						
                        success: function(resp) {
                            console.log('success');
							//console.log(JSON.stringify(resp));
							var radlabels=["January", "February", "March", "April", "May", "June", "July","August","September","October","November","December"];
							var seglabels=["sent-0","sent-1"];
							var clabels=["white","green"];
							var nseg=2;
							draw_circularHeat_chart(resp,radlabels,seglabels,clabels,nseg,"#ch_chart2");						
							
                        }
                    });

         });     

}

getStats_chChart2(2012);

function getStats_chChart(Year){
$.get('http://localhost:3300/UFOreports', function(data) {
        years_list=data;
		years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);});
			 
  // set here your svg properties
                    var data = {};	
                    data.Year=Year;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_chChart',						
                        success: function(resp) {
                            console.log('success');
							//console.log(JSON.stringify(resp));
											
							var radlabels=["January", "February", "March", "April", "May", "June", "July","August","September","October","November","December"];
							var seglabels=rangefn(1,31,1);
							var clabels=["white", "purple"];
							var nseg=31;
							draw_circularHeat_chart(resp,radlabels,seglabels,clabels,nseg,"#ch_chart");	
                        }
                    });

         });     

}

getStats_chChart(2012);

function draw_circularHeat_chart(data,radlabels,seglabels,clabels,nseg,chart_id){
var chart = circularHeatChart()
    .segmentHeight(11)
    .innerRadius(15)
    .numSegments(nseg)
	.range(clabels)
    .radialLabels(radlabels)
    .segmentLabels(seglabels)
   // .margin({top: 20, right: 0, bottom: 20, left: 480});
	
	d3.select(chart_id)
	.append("svg").attr("class","ch_chart-svg")
    .selectAll('svg')
    .data([data])
    .enter()
    .append('svg')
    .call(chart);
	
	/* Add a mouseover event */
d3.selectAll(chart_id+" path").on('mouseover', function() {
    var d = d3.select(this).data()[0];
	//console.log(JSON.stringify(d)); 
    div1.transition()
			    .duration(200) 
				.style("background","lightgreen")
			    .style("opacity", 1); 
				div1.html("<span><b><font face=\"verdana\">Num_Reports: </font>"+d+"</b><br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
		
d3.selectAll("#ch_chart path").on("mouseout",function(d){
	     
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})
		
	
 }
 
 
///////////////////////////////////////////////////////////////////////////////////////
//Area chart for sentiment 0,1 along the years. 
 function getStats_Area()
{
 $.get('http://localhost:3300/UFOreports', function(data) {
        years_list=data;
		years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);});
			 
  // set here your svg properties
                    var data = {};								
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_AreaChart2',						
                        success: function(resp) {
                            console.log('success');
							console.log(JSON.stringify(resp));
							draw_area_chart(resp);					
							
                        }
                    });

         });                 
}

getStats_Area();
 
function draw_area_chart(experiments)
 {
  var width=480,height=300;
 //console.log(Object.keys(experiments[0]));
  var svg = d3_1.select("#area").append("svg").attr("class","svg-area").attr("width",width).attr("height",height),
    margin = {top: 20, right: 20, bottom: 30, left: 50};
	
    width = svg.attr("width") - margin.left - margin.right,
    height = svg.attr("height") - margin.top - margin.bottom;


var x = d3_1.scaleLinear().range([0, width]),
    y = d3_1.scaleLinear().range([height, 0]),
    z = d3_1.scaleOrdinal(d3_1.schemeCategory10);
	

var stack = d3_1.stack();

var area = d3_1.area()
    .x(function(d, i) {//console.log(JSON.stringify(d.data)); 
	    return x(d.data.Year); })
    .y0(function(d) {//console.log(JSON.stringify(d)); 
	    return y(d[0]); })
    .y1(function(d) { 
	    return y(d[1]); });

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//To get keys of an object.
  var keys = ["sent0","sent1"];
  //console.log(d3.extent(experiments, function(d) { return d.Year; }));
  x.domain(d3_1.extent(experiments, function(d) { return +d.Year; }));
  z.domain(keys);
  stack.keys(keys);
   y.domain(d3_1.extent(experiments, function(d) { return d.sent0 +d.sent1; }));
 
  var circle = svg.selectAll("circle")
    .data(experiments)
    .enter()
	.append("circle")
    .attr("r", function(d) { return "3px"; })
	.attr("cx",function(d,i){return x(d.Year+13);})
	.attr("cy",function(d){return y(d.sent0-500);})
    .style("fill", function(d) { return z("sent0"); })
	.on("mouseover",function(d){
	          d3.select(this).transition().attr("r","5px");
			  d3.selectAll(".area").transition().attr("opacity",0.5);
	    	 div1.transition()
			    .duration(200) 
				.style("background","lightgreen")
			    .style("opacity", 1); 
				div1.html("<span><b><font face=\"verdana\">Num_Sentiment0: </font>"+d.sent0+"</b><br/>"+
				"<b><font face=\"verdana\">Year: </font>"+d.Year+"</b></span>")
				.style("left", (d3_1.event.pageX) + "px")	
				 .style("top", (d3_1.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
	     d3.select(this).transition().attr("r","3px");
		 d3.selectAll(".area").transition().attr("opacity",1);
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})	
  
  var circle2 = svg.selectAll(".circle2")
    .data(experiments)
    .enter()
	.append("circle")
	.attr("class","circle2")
    .attr("r", function(d) { return "3px"; })
	.attr("cx",function(d,i){return x(d.Year+13);})
	.attr("cy",function(d){return y(d.sent0+d.sent1-500);})
    .style("fill", function(d) { return z("sent1"); })
	.on("mouseover",function(d){
	          d3.select(this).transition().attr("r","5px");
			  d3.selectAll(".area").transition().attr("opacity",0.5);
	    	 div1.transition()
			    .duration(200) 
				.style("background","lightgreen")
			    .style("opacity", 1); 
				div1.html("<span><b><font face=\"verdana\">Num_Sentiment1: </font>"+d.sent1+"</b><br/>"+
				"<b><font face=\"verdana\">Year: </font>"+d.Year+"</b></span>")
				.style("left", (d3_1.event.pageX) + "px")	
				 .style("top", (d3_1.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
	     d3.select(this).transition().attr("r","3px");
		 d3.selectAll(".area").transition().attr("opacity",1);
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})	
			
  var layer = g.selectAll(".layer")
    .data(stack(experiments))
    .enter().append("g")
      .attr("class", "layer");

  layer.append("path")
      .attr("class", "area")
      .style("fill", function(d) { return z(d.key); })
      .attr("d", area);

  layer.filter(function(d) {//console.log(d.length,JSON.stringify(d));
             return d[d.length - 1][1] - d[d.length - 1][0] > 0.01; })
    .append("text")
      .attr("x", width - 6)
      .attr("y", function(d) { return y((d[d.length - 1][0] + d[d.length - 1][1]) ); })
      .attr("dy", ".35em")
      .style("font", "15px sans-serif")
      .style("text-anchor", "end")
      .text(function(d) { return d.key; });

  g.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(0," + height + ")")
      .call(d3_1.axisBottom(x));

  g.append("g")
      .attr("class", "yaxis")
      .call(d3_1.axisLeft(y));

	  
	  
	  
	  
 }
///////////////////////////////////////////////////////////////////////////////////////
//Draw connected graph for most frequent words
function buttons_txt()
{
var labels=["Sentiment","WordFrequency"];
var defaultColor= "#7777BB"
var hoverColor= "#0000ff"
var pressedColor= "#000077"

var w= 200;
var h= 400;
var svg= d3.select(".text_buttons")
            .append("svg")
            .attr("width",w)
            .attr("height",h)
			.attr("class","svg");
			
var Buttons= svg.append("g")
                    .attr("id","allButtons") 

					
//groups for each button (which will hold a rect and text)
var bGroups= Buttons.selectAll(".button_text")
                        .data(labels)
                        .enter()
                        .append("g")
                        .attr("class","button_text")
                        .style("cursor","pointer")
						 .on("click",function(d) { console.log("clicked");
                                updateButtonColorsT(d3.select(this), d3.select(this.parentNode))
								})
					     .on("mouseover", function() {
			                   if (d3.select(this).select("rect").attr("fill") != pressedColor) {
							    d3.select(this)
								.select("rect")
								.attr("fill",hoverColor);
						       }
					        })
					    .on("mouseout", function() {
					     	if (d3.select(this).select("rect").attr("fill") != pressedColor) {
					     		d3.select(this)
								.select("rect")
								.attr("fill",defaultColor);
						      }
					      });
									
						
var bWidth= 120; //button width
var bHeight= 25; //button height
var bSpace= 10; //space between buttons
var x0= 80; //x offset
var y0= 25; //y offset

//adding a rect to each button group
//sidenote: rx and ry give the rects rounded corners
bGroups.append("rect")
            .attr("class","buttonRect")
            .attr("width",bWidth)
            .attr("height",bHeight)
            .attr("x",x0)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i;})
            .attr("rx",5) 
            .attr("ry",5)
            .attr("fill","steelblue")

//adding text to each button group, centered within the button rect
bGroups.append("text")
            .attr("class","buttonText")
            .attr("font-family","FontAwesome")
            .attr("x",x0+bWidth/2)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i+bHeight/2;})
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return d;})                            


 
function updateButtonColorsT(button, parent) { 
    parent.selectAll("rect")
            .attr("fill",defaultColor)

    button.select("rect")
            .attr("fill",pressedColor)
			
	d3.select("#sentiment").select(".svg-text").remove();
    console.log(JSON.stringify(button[0][0]),button[0][0].__data__);	
    if(button[0][0].__data__ == "Sentiment") 
       getStats_FD();
    else if(button[0][0].__data__ == "WordFrequency")
      getStats_CG();   
}
 
}

buttons_txt(); 

function getStats_CG()
{
 $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
									
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_CGchart',						
                        success: function(resp) {
                            console.log('success');
							console.log(JSON.stringify(resp));
							draw_connected_graph(resp);					
							
                        }
                    });

         });                 
}

getStats_CG();

function draw_connected_graph(nodes)
{
var bleed = 100,
    width = 1000,
    height = 800;


var svgsent = d3.select(".svg-sentiment").append("svg").attr("width",width).attr("height",height)
  .attr("class","svg-text")
  .append("g");

	var rScale=d3.scale.linear().range("3px","5px");
    var xScale=d3.scale.ordinal().rangePoints([50,width-50]).domain(d3.range(11));
    var yScale=d3.scale.ordinal().rangePoints([height+50,50]).domain(d3.range(11));
	var color = d3.scale.category20b().domain(d3.range(10));
	
  rScale.domain([d3.min(nodes,function(d){return +d.name.length}),d3.max(nodes,function(d){return +d.name.length;})]);

  var node = svgsent.selectAll(".node")
      .data(nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + xScale(d.x) + "," + yScale(d.y) + ")"; });
	   

  node.append("circle")
       .attr("class","node-circle")
      .attr("r", function(d) { return  (d.name.length)*5+"px"; })
	  .attr("opacity",0.6)
	  .attr("fill",function(d){return color(d.r);});
	 

  node.append("text")
       .attr("class","node-text")
      .text(function(d) { return d.name; })
      .style("font-size", function(d) { return rScale(Math.min(d.r, (2*d.r - 8) / this.getComputedTextLength() * 24)); })
      .attr("dy", ".35em");
	  
	  node.on("click",function(d){get_closest(d3.select(this));});


function get_closest(node)
{
console.log(JSON.stringify(node));

//create a button and clear the space.

d3.select("#sentiment").select(".svg-text").remove();

 $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
						data.type="nearest";
                         data.word=node[0][0].__data__.name;
						 
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_Closest',						
                        success: function(resp) {
                            console.log('success');
							
							draw_closest_chart(resp);					
							
                        }
                    });

         });                 

}

}

function draw_closest_chart(nodes)
{
var bleed = 100,
    width = 600,
    height = 400;

var svgsent = d3.select(".svg-sentiment").append("svg").attr("width",width).attr("height",height)
  .attr("class","svg-text")
  .append("g");

	var rScale=d3.scale.linear().range("5px","20px");
    var xScale=d3.scale.ordinal().rangePoints([10,width-10]).domain(d3.range(-1,10));
	var yScale=d3.scale.ordinal().rangePoints([height,0]).domain(d3.range(-1,10));
	
   
	
	var color = d3.scale.category20b().domain([d3.min(nodes,function(d){return d.min}),d3.max(nodes,function(d){
	     return d.min})]);
	
  rScale.domain([d3.min(nodes,function(d){return d.min;}),d3.max(nodes,function(d){return d.min;})]);

  var node = svgsent.selectAll(".node")
      .data(nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d,i) { return "translate(" + xScale(i) + "," + yScale(i) + ")"; });
	   

  node.append("circle")
       .attr("class","node-circle")
      .attr("r", function(d) { return (d.max)*3+"px"; })
	  .attr("opacity",0.6)
	  .attr("fill",function(d){return color(d.min);});
	 

  node.append("text")
       .attr("class","node-text")
      .text(function(d) { return d.sim; })
      .style("font-size", function(d) { return rScale(Math.min(d.min, (2*d.min - 8) / this.getComputedTextLength() * 24)); })
      .attr("dy", ".35em");

}


///////////////////////////////////////////////////////////////////////////////////////
//Draw force directed graph --clusterd with sentences and sentiment.

function getStats_FD()
{
 $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
									
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_FDchart',						
                        success: function(resp) {
                            console.log('success');
							
							draw_FD_chart(resp);					
							
                        }
                    });

         });                 
}

//getStats_FD();

function draw_FD_chart(nodes)
{
var width = 960,
    height = 800,
    padding = 1.5, // separation between same-color circles
    clusterPadding = 6, // separation between different-color circles
    maxRadius = 12;

var n = 1000, // total number of circles
    m = 2; // number of distinct clusters

var color = d3.scale.category10()
    .domain(d3.range(m));
var clusters=nodes;


var force = d3.layout.force()
    .nodes(nodes)
    .size([width, height])
    .gravity(.02)
    .charge(0)
    .on("tick", tick)
    .start();

var svg = d3.select(".svg-sentiment").append("svg").attr("class","svg-text")
    .attr("width", width)
    .attr("height", height);

var circle = svg.selectAll("circle")
    .data(nodes)
  .enter().append("circle")
    .attr("r", function(d) { return d.radius; })
    .style("fill", function(d) { return color(d.cluster); })
	.on("mouseover",function(d){
	    	 div1.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div1.html("<span><font face=\"verdana\">Cluster: </font>"+d.cluster+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		
    .call(force.drag);

function tick(e) {
  circle
      .each(cluster(10 * e.alpha * e.alpha))
      .each(collide(.5))
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
}

// Move d to be adjacent to the cluster node.
function cluster(alpha) {
  return function(d) {
    var cluster = clusters[d.cluster];
    if (cluster === d) return;
    var x = d.x - cluster.x,
        y = d.y - cluster.y,
        l = Math.sqrt(x * x + y * y),
        r = d.radius + cluster.radius;
    if (l != r) {
      l = (l - r) / l * alpha;
      d.x -= x *= l;
      d.y -= y *= l;
      cluster.x += x;
      cluster.y += y;
    }
  };
}

// Resolves collisions between d and all other circles.
function collide(alpha) {
  var quadtree = d3.geom.quadtree(nodes);
  return function(d) {
    var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
        nx1 = d.x - r,
        nx2 = d.x + r,
        ny1 = d.y - r,
        ny2 = d.y + r;
    quadtree.visit(function(quad, x1, y1, x2, y2) {
      if (quad.point && (quad.point !== d)) {
        var x = d.x - quad.point.x,
            y = d.y - quad.point.y,
            l = Math.sqrt(x * x + y * y),
            r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
        if (l < r) {
          l = (l - r) / l * alpha;
          d.x -= x *= l;
          d.y -= y *= l;
          quad.point.x += x;
          quad.point.y += y;
        }
      }
      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
    });
  };
}

}



//////////////////////////////////////////////////////////////////////////////////////
//Draw box-whisker plots
var labels=["Year","Month","Day","Year_Posted","Month_Posted","Day_Posted","Sentiment"];

var w= 200;
var h= 400;
var svg_button= d3.select(".choice_buttons")
            .append("svg")
            .attr("width",w)
            .attr("height",h);
			
var allButtons= svg_button.append("g")
                    .attr("id","allButtons_box") 

					
//groups for each button (which will hold a rect and text)
var buttonGroups= allButtons.selectAll(".button")
                        .data(labels)
                        .enter()
                        .append("g")
                        .attr("class","button_box")
                        .style("cursor","pointer")
						 .on("click",function(d) {
                                updateButtonColorsBox(d3.select(this), d3.select(this.parentNode))
								})
					     .on("mouseover", function() {
			                   if (d3.select(this).select("rect").attr("fill") != pressedColor) {
							    d3.select(this)
								.select("rect")
								.attr("fill",hoverColor);
						       }
					        })
					    .on("mouseout", function() {
					     	if (d3.select(this).select("rect").attr("fill") != pressedColor) {
					     		d3.select(this)
								.select("rect")
								.attr("fill",defaultColor);
						      }
					      })
									
						
var bWidth= 120; //button width
var bHeight= 25; //button height
var bSpace= 10; //space between buttons
var x0= 80; //x offset
var y0= 25; //y offset

//adding a rect to each button group
//sidenote: rx and ry give the rects rounded corners
buttonGroups.append("rect")
            .attr("class","buttonRect_box")
            .attr("width",bWidth)
            .attr("height",bHeight)
            .attr("x",x0)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i;})
            .attr("rx",5) 
            .attr("ry",5)
            .attr("fill","steelblue")

//adding text to each button group, centered within the button rect
buttonGroups.append("text")
            .attr("class","buttonText_box")
            .attr("font-family","FontAwesome")
            .attr("x",x0+bWidth/2)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i+bHeight/2;})
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return d;})                            

var defaultColor= "#7777BB"
var hoverColor= "#0000ff"
var pressedColor= "#000077"
 
function updateButtonColorsBox(button, parent) { //when buttons1 are clicked.
    parent.selectAll("rect")
            .attr("fill",defaultColor)

    button.select("rect")
            .attr("fill",pressedColor)
			
	//d3.select(".svg-counts").selectAll(".parent-to-all").remove();
	/*
	d3.select(".svg-counts").selectAll(".lines").remove();
	d3.select(".svg-counts").selectAll(".circles").remove();
	d3.select(".svg-counts").selectAll(".bars").remove();
	d3.select(".svg-counts").selectAll(".label").remove();
	d3.select(".svg-counts").selectAll(".label-text").remove();
	d3.select(".chart1").select(".buttons2").remove();
	*/
	d3.select(".whisker").select(".svg-box").remove();
			
    console.log(JSON.stringify(button[0][0]),button[0][0].__data__);	
   getStats_Box(button[0][0].__data__);	
}
  
getStats_Box("Year");  
function getStats_Box(type)
{
 $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					
					data.type=type;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_BoxChart',						
                        success: function(resp) {
                            console.log('success');
							
							draw_Box_Chart(resp);					
							
                        }
                    });

         });                 
}

function draw_Box_Chart(experiments)
{
var margin = {top: 10, right: 50, bottom: 10, left: 50},
    width = 120 - margin.left - margin.right,
    height = 150 - margin.top - margin.bottom;

var min = Infinity,
    max = -Infinity;

var chart = d3.box()
    .whiskers(iqr(1.5))
    .width(width)
    .height(height);
	
var data = [];

  experiments.forEach(function(x) {
    var e = Math.floor(x.expt - 1),
        r = Math.floor(x.run - 1),
        s = Math.floor(x.value),
        d = data[e];
    if (!d) d = data[e] = [s];
    else d.push(s);
    if (s > max) max = s;
    if (s < min) min = s;
  });

  chart.domain([min, max]);

  var svg = d3.select(".whisker").append("svg").attr("class","svg-box")
      
        .selectAll("svg")
        .data(data)
        .enter().append("svg")
      .attr("class", "box")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.bottom + margin.top)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
	  //.attr("transform","rotate(-90)" )
      .call(chart);

	 // d3.select(".svg-box").transition().attr("transform","rotate(-90)" );
	  
  setInterval(function() {
    svg.datum(randomize).call(chart.duration(5));
  }, 5);


function randomize(d) {
  if (!d.randomizer) d.randomizer = randomizer(d);
  return d.map(d.randomizer);
}

function randomizer(d) {
  var k = d3.max(d) * .02;
  return function(d) {
    return Math.max(min, Math.min(max, d + k * (Math.random() - .5)));
  };
}

// Returns a function to compute the interquartile range.
function iqr(k) {
  return function(d, i) {
    var q1 = d.quartiles[0],
        q3 = d.quartiles[2],
        iqr = (q3 - q1) * k,
        i = -1,
        j = d.length;
    while (d[++i] < q1 - iqr);
    while (d[--j] > q3 + iqr);
    return [i, j];
   };
  }   
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Pie chart for initial display
 
function draw_pieChart(y,experiments)
{
         var chart = dc.pieChart("#pie-chart");
          d3.select("#pie-chart").select("#year-text")
		    
		    .append("text")
            .attr("class","texts")
            .attr("font-family","FontAwesome")
             .attr("font-size","50px")
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return "Year- "+y;})  
			
			
          var ndx           = crossfilter(experiments),
          runDimension  = ndx.dimension(function(d) {return d._id;})
      speedSumGroup = runDimension.group().reduceSum(function(d) {return d.count;});

       
      chart
           .cx("350") 
		   .cy("100")
          .slicesCap(4)
          .innerRadius(5)
          .externalLabels(1)
          .externalRadiusPadding(5)
          .drawPaths(true)
          .dimension(runDimension)
          .group(speedSumGroup)
		   .minAngleForLabel(0.5)
          .legend(dc.legend().x(120).y(25))
		  .renderLabel(true);
		   
      // example of formatting the legend via svg
      // http://stackoverflow.com/questions/38430632/how-can-we-add-legends-value-beside-of-legend-with-proper-alignment
      chart.on('pretransition', function(chart) {
          chart.selectAll('.dc-legend-item text')
              .text('')
            .append('tspan')
              .text(function(d) { return  d.name; })
            .append('tspan')
              .attr('x', 100)
              .attr('text-anchor', 'end')
              .text(function(d) { return d.data; });
      });
	  
      chart.render();
	 
}

var first=1;
var width=500,height=300;
 //console.log(Object.keys(experiments[0]));
  var svgline = d3.select("#line-chart")
           .append("svg")
		   .attr("class","svg-line")
		   .attr("width",width)
		   .attr("height",height),
    margin = {top: 20, right: 20, bottom: 30, left: 50};
	
    width = svgline.attr("width") - margin.left - margin.right,
    height = svgline.attr("height") - margin.top - margin.bottom;
	
function draw_Line_Chart(year,experiments)
{
console.log("called line chart...");
  var xScale= d3.scale.ordinal().rangePoints([0, width]);
  var yScale= d3.scale.linear().range([height, 0]);
  var y_min=experiments['Min'];
  var y_max=experiments['Max'];
  
  xScale.domain(d3.range(12));
  yScale.domain([y_min-10,y_max]);
      
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(13);
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(4);

	var line1 = d3.svg.line()
    .x(function(d,i) {console.log(d); return xScale(d._id); })
    .y(function(d) { return yScale(d.count); });
   
	var container=svgline.append("g").attr("class","parent-to-all");
	 // x-axis
	 if(first==1)
	{
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Months")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx",".5em")
      .attr("dy", ".8em")
      .style("text-anchor", "end")
      .text("UFO reports per country")	 ;

	  var color_leg=[{"color":"orange","C":"us"},{"color":"pink","C":"ca"},{"color":"green","C":"gb"},
	 {"color":"purple","C":"au"}];
	 
   var l=legend.selectAll("rect")
   .data(color_leg).enter();
   
   l.append("rect")
  .attr("x", width+35)
  .attr("y", function(d,i){return 25+15*i;})
  .attr("width", 10)
  .attr("height", 10)
  .style("fill",function(d){return d.color;});

  l.append("text")
  .attr("x",  width+45)
  .attr("y", function(d,i){return 25+15*i;})
  .text(function(d) { return d.C; });
  
first=0;
	}
else{
 d3.select(".svg-line")
			.select(".yaxis") // change the x axis
		    .transition()
            .duration(50)
            .call(yAxis);
			
    // d3.selectAll(".gs").transition().attr("opacity",0);
	d3.selectAll("#line-chart").selectAll(".lines").remove();

}
var c=container.append("g")
	   .attr("transform", "translate(40,0)");
	   
	   c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "orange")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments["us"]));
      
	  c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "pink")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments["ca"]));
	   
	   c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "green")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments["gb"]));
	   
	  c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "purple")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments["au"]));
}

function getStats_PC(year)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					
					data.value=year;
					console.log(year);
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_PieChart',						
                        success: function(resp) {
                            console.log('success');
							draw_pieChart(year,resp);
						 
							
                        }
                    });

         });                 
  return 0;
  }

  function getStats_LC(year)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					
					data.Year=year;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_LineChart',						
                        success: function(resp) {
                            console.log('LC: success');
							draw_Line_Chart(year,resp);
						 
							
                        }
                    });

         });                 
  return 0;
  }
  
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

var years_list=[];
function repeat()
{
    $.get('http://localhost:3300/UFOreports', function(data) {
     years_list=data;
	  years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);
    });

    getStats_PC_loop(years_list[year_id]);
	getStats_LC_loop(years_list[year_id]);
	 }); 
   
 }
 
var year_id=0;
getStats_PC(2012);
getStats_LC(2012);

 function getStats_PC_loop(year)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					
					data.value=year;
					console.log(year);
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_PieChart',						
                        success: function(resp) {
                            console.log('success');
							d3.select("#pie-chart").select(".texts").remove();
							draw_pieChart(year,resp);
						    year_id+=1
							if(year_id<years_list.length)
                               {
							   sleep(3000).then(() => {
							   getStats_PC_loop(years_list[year_id]);
							   });
                                   }							
							
                        }
                    });

         });                 
  }
  
  function getStats_LC_loop(year)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					
					data.Year=year;
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_LineChart',						
                        success: function(resp) {
                            console.log('success');
							
							draw_Line_Chart(year,resp);
						    year_id+=1
							if(year_id<years_list.length)
                               {
							   sleep(3000).then(() => {
							   getStats_LC_loop(years_list[year_id]);
							   });
                                   }							
							
                        }
                    });

         });                 
  }
  
getStats("Year");
add_buttons2("Year");

//==================================================================================================
 //Parallel coordinates
 //year --choose --pattern 
 
 $.get('http://localhost:3300/UFOreports', function(data) {
		      years_list=data;
			  
			  years_list.sort(function(a, b) {
             return parseFloat(a) - parseFloat(b);
});

$.get('http://localhost:3300/UFOreports_Countries', function(data) {
		      var countries_list=data;
			  console.log(countries_list);
			  
			  var dat={};
              dat.year =1910; //default.
			  dat.Country="us";
			  
   var sel=d3.select(".selectmenu_year")
            .append("select")
            .attr("class","sel")
	     	.on("change",onchange);
              		
   var options = sel.selectAll(".option")
	            .data(years_list).enter()
	            .append("option")
				.attr("class","option")
	            .text(function (d) { return d; });
				
var sel2=d3.select(".selectmenu_country")
            .append("select")
            .attr("class","sel")
	     	.on("change",onchange2);
              		
   var options2 = sel2.selectAll(".option")
	            .data(countries_list).enter()
	            .append("option")
				.attr("class","option")
	            .text(function (d) { return d; });
                   
				
function onchange(){
   var selectedIndex = sel.property('selectedIndex'),
       selected_data          = options[0][selectedIndex].__data__;
   console.log(selected_data);
  
   var indx=years_list.indexOf(selected_data);
   dat.year=selected_data;
   getStats_pcoord(dat);
 }	   
 
 function onchange2(){
   var selectedIndex = sel2.property('selectedIndex'),
       selected_data2          = options2[0][selectedIndex].__data__;
   console.log(selected_data2);
  
   var indx=countries.indexOf(selected_data2);
   dat.Country=selected_data2;
   getStats_pcoord(dat);
 }	   
 
 getStats_pcoord(dat);
 
 })
 
 });
 
 function getStats_pcoord(data){
console.log("Data.year= ",data.year); 
console.log("Data.Country= ",data.Country);
 $.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_pcoordChart',						
                        success: function(resp) {
                           console.log('success',JSON.stringify(resp));	  
                           d3.select("#example").select(".pcoord").remove();
						   d3.select(".pcoord-title").remove();
						   d3.select(".pcoord-title").html("<span><font face=\"verdana\">Year: </font>"+data.year+"<br/>"+
			
						 "<font face=\"verdana\">Country: </font>"+data.Country+"<br/></span>");
						 
                           draw_pcoordinates_chart(resp);
                     }
					 });
 
 }
 
 
function draw_pcoordinates_chart(experiments)
{

if(experiments.length >100)
{
//sample out 100 random points.
//How to?
}

var times=["Dawn","Morning","Noon","Night"];

var data=[];
experiments.forEach(function(element){
     var singleObj={};
     singleObj["Month"]=+element.Month;
	 singleObj["Day"]=+element.Day;
	 singleObj["State"]=element.State;
	 singleObj["Time_mins"]=element.Time_mins;
	 var t=element.Time.split(":")[0];
	 if(t<6)	 singleObj["Time"]=times[0];
	 else if(t<12) singleObj["Time"] =times[1];
	 else if(t<18) singleObj["Time"] =times[2];
	 else  singleObj["Time"] =times[3]; 
	 //singleObj["Month_Posted"]=+element.Month_Posted;
	 //singleObj["Day_Posted"]=+element.Day_Posted;
	// singleObj["Year_Posted"]=+element.Year_Posted;
	 singleObj["City"] =element.City;
	 data.push(singleObj);
})

var blue_to_brown = d3.scale.linear()
  .domain([1,12]) //Months
  .range(["green", "pink"])
  .interpolate(d3.interpolateLab);

// interact with this variable from a javascript console
var pc1;

var dims={ 'Month':{type:'number'},
           'Day':{type:'number'},
		   'State':{type:'string'},
		   'Time_mins':{type:'number'},
           'Time':{type:'string'},
	       'City':{orient: 'right',
			    type: 'string',
			    tickPadding: 0,
			    innerTickSize: 8}}

  pc1 = d3.parcoords()("#example")
    .data(data)
    .hideAxis(["name"])
    .composite("darken")
    .color(function(d) { return blue_to_brown(d['Month']); })  // quantitative color scale
    .alpha(0.35)
    .render()
    .brushMode("1D-axes")  // enable brushing
    .interactive()  // command line mode
	.dimensions(dims);

  var explore_count = 0;
  var exploring = {};
  var explore_start = false;
  pc1.svg
    .attr("class","pcoord")
    .selectAll(".dimension")
    .style("cursor", "pointer")
    .on("click", function(d) {
      exploring[d] = d in exploring ? false : true;
      event.preventDefault();
      if (exploring[d]) d3.timer(explore(d,explore_count));
    });

  function explore(dimension,count) {
    if (!explore_start) {
      explore_start = true;
      d3.timer(pc1.brush);
    }
    var speed = (Math.round(Math.random()) ? 1 : -1) * (Math.random()+0.5);
    return function(t) {
      if (!exploring[dimension]) return true;
      var domain = pc1.yscale[dimension].domain();
      var width = (domain[1] - domain[0])/4;

      var center = width*1.5*(1+Math.sin(speed*t/1200)) + domain[0];

      pc1.yscale[dimension].brush.extent([
        d3.max([center-width*0.01, domain[0]-width/400]),
        d3.min([center+width*1.01, domain[1]+width/100])
      ])(pc1.g()
          .filter(function(d) {
            return d == dimension;
          })
      );
    };
  };

}

//////////////////////////////////////////////////////////////////////////////////////////////////////////
//choropleth2
/*
function getStats_Choropleth2(year){
       $.get('http://localhost:3300/UFOreports', function(data) {	 
                 var data = {};		
				
					data.Year=year;
					data.Country="us";
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_Choropleth2',						
                        success: function(resp) {
                           		 console.log(JSON.stringify(resp));		
								  draw_Choropleth2_chart(year,resp);
								 
								  
                        }
                    });

         });                 
 }

getStats_Choropleth2(2012);
 function getStats_Bubble2_Chart(year,cityName){
     	  $.get('http://localhost:3300/UFOreports', function(data) {	 
                    var data = {};
					
                    data.City=cityName;					
					data.Year=year;
					
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_Bubble2',						
                        success: function(resp) {
                           		 console.log(JSON.stringify(resp));		
								  draw_Bubble2_chart(resp);
								 
								  
                        }
                    });

         });                 
 
 }

 function draw_Bubble2_chart(experiments){
 var margin = 30,
    w = 300 - margin * 2,
    h = w,
    radius = w / 2,
    strokeWidth = 4,
    hyp2 = Math.pow(radius, 2),
    nodeBaseRad = 5;

var svg = d3.select('#bubble').append('svg')
    .attr('width', w + margin * 2)
    .attr('height', h + margin * 2)
	.attr("class","svg-bubbles")
.append('g')
    .attr('transform', 'translate(' + margin + ',' + margin + ')');

var color = d3.scale.category20b();

var pool = svg.append('circle')
    .style('stroke-width', strokeWidth * 2)
    .attr({
        class: 'pool',
        r: radius,
        cy: 0,
        cx: 0,
        transform: 'translate(' + w / 2 + ',' + h / 2 + ')'
    });
	
 var force = d3.layout.force()
    .charge(-50)
    .gravity(0.05)
    .nodes(experiments)
    .size([w, h]);

var nodes = svg.selectAll('.nodes')
    .data(experiments)
    .enter()
	.append('circle')
    .attr({
        class: 'nodes',
        r: function (d) { return d.rad + nodeBaseRad; },
        //fill: "#fff8d1"
        fill: function (d) { return color(d.City); }
	})
	.on('mouseover', function() {
	var d = d3.select(this).data()[0];
	d3.select(this).transition().attr("r","6px");
    div1.transition()
			    .duration(200) 
				.style("background","lightgreen")
			    .style("opacity", 1); 
    div1.html("<span><b><font face=\"verdana\">Property: </font>"+d.Property+"</b><br/>"+
				"<b><font face=\"verdana\">Num Reports: </font>"+d.rad+"</b></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
	.on("mouseout",function(d){
	     d3.select(this).transition().attr("r",function (d) { return d.rad + nodeBaseRad; });
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})	
  
function pythag(r, b, coord) {
    r += nodeBaseRad;
    // force use of b coord that exists in circle to avoid sqrt(x<0)
    b = Math.min(w - r - strokeWidth, Math.max(r + strokeWidth, b));
    var b2 = Math.pow((b - radius), 2),
        a = Math.sqrt(hyp2 - b2);
    // radius - sqrt(hyp^2 - b^2) < coord < sqrt(hyp^2 - b^2) + radius
    coord = Math.max(radius - a + r + strokeWidth,
                Math.min(a + radius - r - strokeWidth, coord));

    return coord;
}

function tick() {
    nodes.attr('cx', function (d) { return d.x = pythag(d.rad, d.y, d.x); })
        .attr('cy', function (d) { return d.y = pythag(d.rad, d.x, d.y); });
}

nodes.call(force.drag);
force.on('tick', tick)
    .start();
 
 }
 
 function draw_Choropleth2_chart(year,experiments)
 {
    var map = new Datamap({
        element: document.getElementById('container'),
        scope: 'usa',		
		
		fills: {
            HIGH: '#afafaf',
            HIGH_MED: 'green',
            MEDIUM: 'blue',
            UNKNOWN: 'rgb(0,0,0)',
            defaultFill: 'rgb(0,0,0)'
        },
		done: function(datamap) {
            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
			d3.select(".svg-bubbles").remove();
                getStats_Bubble2_Chart(year,geography.properties.name);
            });
        },
		 data: {
		   GBR: {
                fillKey: 'MEDIUM',
                numberOfThings: experiments['gb']
            },
		    CAN: {
                fillKey: 'HIGH_MED',
                numberOfThings: experiments['ca']
            },
            AUS: {
                fillKey: 'MEDIUM',
                numberOfThings: experiments['au']
            },
            USA: {
                fillKey: 'HIGH',
                numberOfThings: experiments['us']
            }
        },
		geographyConfig: {
		 highlightOnHover: false,
            popupTemplate: function(geo, data) {
                return ['<div class="hoverinfo"><strong>',
                        'Number of things in ' + geo.properties.name,
                        ': ' + data.numberOfThings,
                        '</strong></div>'].join('');
            }
        }
    });
	 map.legend();
  }
  
 */
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
function getStats_Choropleth(year){
       $.get('http://localhost:3300/UFOreports', function(data) {	 
                 var data = {};
								
					data.type='world'; 
					data.Year=year;
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_Choropleth',						
                        success: function(resp) {
                           		 console.log(JSON.stringify(resp));		
								  draw_Choropleth_chart(year,resp);
								 
								  
                        }
                    });

         });                 
 }

getStats_Choropleth(2012);
 function getStats_Bubble_Chart(year,countryName){
     	  $.get('http://localhost:3300/UFOreports', function(data) {	 
                    var data = {};
					var cname={"Canada":"ca","United States of America":"us","United Kingdom":"gb",
					"Australia":"au"};
                    data.Country=cname[countryName];					
					data.Year=year;
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports_Bubble',						
                        success: function(resp) {
                           		 console.log(JSON.stringify(resp));		
								  draw_Bubble_chart(resp);
								 
								  
                        }
                    });

         });                 
 
 }
 
 function draw_Bubble_chart(experiments){
 var margin = 30,
    w = 500 - margin * 2,
    h = w,
    radius = w / 2,
    strokeWidth = 4,
    hyp2 = Math.pow(radius, 2),
    nodeBaseRad = 5;

var svg = d3.select('#bubble').append('svg')
    .attr('width', w + margin * 2)
    .attr('height', h + margin * 2)
	.attr("class","svg-bubbles")
.append('g')
    .attr('transform', 'translate(' + margin + ',' + margin + ')');

var color = d3.scale.category20b();

var pool = svg.append('circle')
    .style('stroke-width', strokeWidth * 2)
    .attr({
        class: 'pool',
        r: radius,
        cy: 0,
        cx: 0,
        transform: 'translate(' + w / 2 + ',' + h / 2 + ')'
    });
	
 var force = d3.layout.force()
    .charge(-50)
    .gravity(0.05)
    .nodes(experiments)
    .size([w, h]);

var nodes = svg.selectAll('.nodes')
    .data(experiments)
    .enter()
	.append('circle')
    .attr({
        class: 'nodes',
        r: function (d) { return d.rad + nodeBaseRad; },
        //fill: "#fff8d1"
        fill: function (d) { return color(d.City); }
	})
	.on('mouseover', function() {
	var d = d3.select(this).data()[0];
	d3.select(this).transition().attr("r","6px");
    div1.transition()
			    .duration(200) 
				.style("background","lightgreen")
			    .style("opacity", 1); 
    div1.html("<span><b><font face=\"verdana\">City: </font>"+d.City+"</b><br/>"+
				"<b><font face=\"verdana\">Num Reports: </font>"+d.rad+"</b></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
	.on("mouseout",function(d){
	     d3.select(this).transition().attr("r",function (d) { return d.rad + nodeBaseRad; });
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})	
  
function pythag(r, b, coord) {
    r += nodeBaseRad;
    // force use of b coord that exists in circle to avoid sqrt(x<0)
    b = Math.min(w - r - strokeWidth, Math.max(r + strokeWidth, b));
    var b2 = Math.pow((b - radius), 2),
        a = Math.sqrt(hyp2 - b2);
    // radius - sqrt(hyp^2 - b^2) < coord < sqrt(hyp^2 - b^2) + radius
    coord = Math.max(radius - a + r + strokeWidth,
                Math.min(a + radius - r - strokeWidth, coord));

    return coord;
}

function tick() {
    nodes.attr('cx', function (d) { return d.x = pythag(d.rad, d.y, d.x); })
        .attr('cy', function (d) { return d.y = pythag(d.rad, d.x, d.y); });
}

nodes.call(force.drag);
force.on('tick', tick)
    .start();
 
 }
 
 function draw_Choropleth_chart(year,experiments)
 {
    var map = new Datamap({
        element: document.getElementById('container'),
        scope: 'world',		
		
		fills: {
            HIGH: '#afafaf',
            HIGH_MED: 'green',
            MEDIUM: 'blue',
            UNKNOWN: 'rgb(0,0,0)',
            defaultFill: 'rgb(0,0,0)'
        },
		done: function(datamap) {
            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
			d3.select(".svg-bubbles").remove();
                getStats_Bubble_Chart(year,geography.properties.name);
            });
        },
		 data: {
		   GBR: {
                fillKey: 'MEDIUM',
                numberOfThings: experiments['gb']
            },
		    CAN: {
                fillKey: 'HIGH_MED',
                numberOfThings: experiments['ca']
            },
            AUS: {
                fillKey: 'MEDIUM',
                numberOfThings: experiments['au']
            },
            USA: {
                fillKey: 'HIGH',
                numberOfThings: experiments['us']
            }
        },
		geographyConfig: {
		 highlightOnHover: false,
            popupTemplate: function(geo, data) {
                return ['<div class="hoverinfo"><strong>',
                        'Number of things in ' + geo.properties.name,
                        ': ' + data.numberOfThings,
                        '</strong></div>'].join('');
            }
        }
    });
	 map.legend();
  }
  
//===============================================================================================================
//Line-bar-charts
//Q:How to fix the position of buttons2??

 
var selected={};
selected.b1="Year";
selected.v1=2012;
selected.b2="Country";

var div1 = d3.select(".chart1").append("div")	
              .attr("class", "tooltip")				
              .style("opacity", 0);

var div2 = d3.select(".chart1").append("div")	
              .attr("class", "tooltip")				
              .style("opacity", 0);


var labels=["Year","Country","Shape"];

var w= 680;
var h= 50;
var svg_button= d3.select(".buttons")
            .append("svg")
            .attr("width",w)
            .attr("height",h);
			
var allButtons= svg_button.append("g")
                    .attr("id","allButtons") 

					
//groups for each button (which will hold a rect and text)
var buttonGroups= allButtons.selectAll(".button")
                        .data(labels)
                        .enter()
                        .append("g")
                        .attr("class","button1")
                        .style("cursor","pointer")
						 .on("click",function(d) {
                                updateButtonColors(d3.select(this), d3.select(this.parentNode))
								})
					     .on("mouseover", function() {
			                   if (d3.select(this).select("rect").attr("fill") != pressedColor) {
							    d3.select(this)
								.select("rect")
								.attr("fill",hoverColor);
						       }
					        })
					    .on("mouseout", function() {
					     	if (d3.select(this).select("rect").attr("fill") != pressedColor) {
					     		d3.select(this)
								.select("rect")
								.attr("fill",defaultColor);
						      }
					      })
									
						
var bWidth= 80; //button width
var bHeight= 25; //button height
var bSpace= 10; //space between buttons
var x0= 80; //x offset
var y0= 25; //y offset

//adding a rect to each button group
//sidenote: rx and ry give the rects rounded corners
buttonGroups.append("rect")
            .attr("class","buttonRect1")
            .attr("width",bWidth)
            .attr("height",bHeight)
            .attr("x",function(d,i) {
                return x0+(bWidth+bSpace)*i;
            })
            .attr("y",y0)
            .attr("rx",5) 
            .attr("ry",5)
            .attr("fill","steelblue")

//adding text to each button group, centered within the button rect
buttonGroups.append("text")
            .attr("class","buttonText1")
            .attr("font-family","FontAwesome")
            .attr("x",function(d,i) {
                return x0 + (bWidth+bSpace)*i + bWidth/2;
            })
            .attr("y",y0+bHeight/2)
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return d;})                            

var defaultColor= "#7777BB"
var hoverColor= "#0000ff"
var pressedColor= "#000077"
 
function updateButtonColors(button, parent) { //when buttons1 are clicked.
    parent.selectAll("rect")
            .attr("fill",defaultColor)

    button.select("rect")
            .attr("fill",pressedColor)
			
	//d3.select(".svg-counts").selectAll(".parent-to-all").remove();
	d3.select(".svg-counts").selectAll(".lines").remove();
	d3.select(".svg-counts").selectAll(".circles").remove();
	d3.select(".svg-counts").selectAll(".bars").remove();
	d3.select(".svg-counts").selectAll(".label").remove();
	d3.select(".svg-counts").selectAll(".label-text").remove();
	d3.select(".chart1").select(".buttons2").remove();
	
	selected.b1=button[0][0].__data__;
	getStats(button[0][0].__data__);		
    //console.log(JSON.stringify(button[0][0]),button[0][0].__data__);	
    if(button[0][0].__data__ =="Year"||button[0][0].__data__ =="Shape")
    add_buttons2(button[0][0].__data__);  	
}
  
function getStats(message)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					data.type="Counts";
					data.message=message;
					console.log(message);
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports',						
                        success: function(resp) {
                            console.log('success');
							//getMatchStats("Year",2012,"Month");
   							draw_count_charts(message,resp);
							
                        }
                    });

         });
                   
  }
  
 //Set up svg canvas --counts plots. 
 var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 580 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;
	
   // Adds the svg canvas
   var	svg = d3.select(".chart1")
	.append("svg")
	 .attr("class","svg-counts")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	    .append("g")
		.attr("transform", "translate(" + margin.right+"," + margin.bottom + ")") ;
 


//For the button-2


function add_buttons2(m1) 
{
if(m1=="Year")
{
  var labels=["Month","Country"];
}
else{
var labels=["Year","Country"];
}
					
//groups for each button (which will hold a rect and text)
var W=80;
var H=height;
var allButtons2= d3.select(".chart1")
            .append("div")
			.attr("class","div-buttons2")
			.append("svg")
			.attr("width",W)
			.attr("height",H)
			.attr("class","buttons2");
			
var buttonGroups2= allButtons2
   					   .selectAll(".button2")
                        .data(labels)
                        .enter()
                        .append("g")
                        .attr("class","button2")
                        .style("cursor","pointer")
						 .on("click",function(d) {
                                updateButtonColors2(d3.select(this), d3.select(this.parentNode))
								})
					     .on("mouseover", function() {
			                   if (d3.select(this).select("rect").attr("fill") != pressedColor) {
							    d3.select(this)
								.select("rect")
								.attr("fill",hoverColor);
						       }
					        })
					    .on("mouseout", function() {
					     	if (d3.select(this).select("rect").attr("fill") != pressedColor) {
					     		d3.select(this)
								.select("rect")
								.attr("fill",defaultColor);
						      }
					      })
									
						
var bWidth= 50; //button width
var bHeight= 25; //button height
var bSpace= 10; //space between buttons
var x0= 10; //x offset
var y0= 25; //y offset

//adding a rect to each button group
//sidenote: rx and ry give the rects rounded corners
buttonGroups2.append("rect")
            .attr("class","buttonRect2")
            .attr("width",bWidth)
            .attr("height",bHeight)
            .attr("x",x0)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i;})
            .attr("rx",5) 
            .attr("ry",5)
            .attr("fill","steelblue")

//adding text to each button group, centered within the button rect
buttonGroups2.append("text")
            .attr("class","buttonText1")
            .attr("font-family","FontAwesome")
            .attr("x",x0+bWidth/2)
            .attr("y",function(d,i) {
                return y0+(bHeight+bSpace)*i+bHeight/2;})
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return d;})                            

var defaultColor= "#7777BB"
var hoverColor= "#0000ff"
var pressedColor= "#000077"

function updateButtonColors2(button, parent) {
    parent.selectAll("rect")
            .attr("fill",defaultColor)

    button.select("rect")
            .attr("fill",pressedColor)
		
	
	//getStats(button[0][0].__data__);	
    selected.b2= button[0][0].__data__;
 	
    console.log(JSON.stringify(button[0][0]),button[0][0].__data__,);			
     Update_chart2();
	 
	}
}

function draw_Year_chart(experiments)
{
experiments.sort(function(a, b) {
    return parseFloat(a._id) - parseFloat(b._id);
});
  selected.b1="Year";
  selected.v1=2012;
  selected.b2="Month";
  Update_chart2();
  
  
  var xScale= d3.scale.linear().range([0, width-20]);
  var yScale= d3.scale.linear().range([height, 0]);
  
  xScale.domain([d3.min(experiments,function(d){return +d._id}),d3.max(experiments,function(d){return +d._id})]);
  yScale.domain([d3.min(experiments,function(d){return +d.count}),d3.max(experiments,function(d){return +d.count})]);
      
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(10);
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(20);

	var line1 = d3.svg.line()
    .x(function(d,i) { return xScale(d._id); })
    .y(function(d) { return yScale(d.count); });
   
	var container=svg.append("g").attr("class","parent-to-all");
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Years")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx",".5em")
      .attr("dy", ".8em")
      .style("text-anchor", "end")
      .text("UFO reports")	 ;

	  var c=container.append("g")
	   .attr("transform", "translate(40,0)");
	  
       
	    c.selectAll(".circles")
       .data(experiments)
       .enter()
       .append("circle")
	   .attr("class","circles")
       .attr("r","3px")
       .attr("cx",function(d){return xScale(d._id);})
       .attr("cy",function(d){return yScale(d.count);})
 	    .attr("fill","gold")
		.on("click",function(d){ 
                                                          
          d3.select(this)
            .style("fill","lightcoral")
            .style("stroke","red");		
	      console.log(JSON.stringify(d3.select(this)));
		   selected.v1=d3.select(this)[0][0].__data__._id;
		   Update_chart2();
		   
		   //call the function to draw color heat chart.
		   d3.selectAll('.ch_chart-svg').remove();
		   getStats_chChart(selected.v1);
		   getStats_chChart2(selected.v1);
		   getStats_chChart3(selected.v1); 
		   
		   d3.select("#sunburst").select("svg").remove();
           getStats_sb(selected.v1);
           getStats_heatmap(selected.v1); //sravika
		   
            d3.select("#container").remove();
			d3.select("#bubble").remove();
			
			d3.select("#Choropleth")
			.append("div")
			.attr("id","container")
			.style("width","800px") 
            .style("height","500px");
			
			d3.select("#Choropleth")
			.append("div")
			.attr("id","bubble");
			
			getStats_Choropleth(selected.v1);			
 		   
        })
		
		.on("mouseover",function(d){
		d3.select(this).transition().attr('r','5px');
	    	 div1.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div1.html("<span><font face=\"verdana\">Country: </font>"+d._id+"<br/>"+
			
						 "<font face=\"verdana\">Num Reports: </font>"+d.count+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
        d3.select(this).transition().attr('r','5px');		
		div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		;
	  
	   c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments));
      
	
	}
  
function draw_Country_chart(experiments)
{
   selected.b1="Country";
   selected.v1="us";
   selected.b2="Year";
   Update_chart2();
   
  var xScale= d3.scale.ordinal().rangePoints([0, width-20]);
  var yScale= d3.scale.linear().range([height, 0]);
  console.log(JSON.stringify(experiments));
  
  var dkeys=[];
  for (exp in experiments)
  {
  dkeys.push(experiments[exp]._id);
  }
   
  // console.log(dkeys);
   
  //console.log(d3.extent(experiments,function(d){return d._id;}));
  xScale.domain(dkeys);
  yScale.domain([-10,d3.max(experiments,function(d){return +d.count})]);
    
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(4);
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(20);

	var container=svg.append("g").attr("class","parent-to-all");
	 
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Countries")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx",".5em")
      .attr("dy", ".8em")
      .style("text-anchor", "end")
      .text("UFO reports")
	 ;

var bars=container.append("g")
	     .attr("transform", "translate(40,0)")  
         .selectAll(".gs")
         .data(experiments)
         .enter()
		 .append("g").attr("class","gs");
		 
    bars.selectAll(".bars")
	     .data(experiments)
		 .enter()
	    .append("rect")
	    .attr("class", "bars") 
	    .attr("x",function(d){ return xScale(d._id);})
		.attr("y",function(d){ return yScale(d.count);})
        .attr("width",30)
		.attr("height",function(d){ return height-yScale(d.count);}) 
	     .style("fill","steelblue")
		 .on("click",function(d){
		 console.log(JSON.stringify(d3.select(this)));
		  selected.v1=d3.select(this)[0][0].__data__._id;
		   selected.b2="Year"; 
		   Update_chart2();
		   
		 })
		 .on("mouseover",function(d){
	    	 div1.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div1.html("<span><font face=\"verdana\">Country: </font>"+d._id+"<br/>"+
			
						 "<font face=\"verdana\">Num Reports: </font>"+d.count+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		;
	 
}
 
function draw_Shape_chart(experiments)
{
selected.b1="Shape";
selected.v1="light";
selected.b2="Year";
Update_chart2();

  var yScale= d3.scale.ordinal().rangePoints([height,0]);
  var xScale= d3.scale.linear().range([0, width-20]);
  console.log(JSON.stringify(experiments));
  
  var dkeys=[];
  for (exp in experiments)
  {
  dkeys.push(experiments[exp]._id);
  }
   
  yScale.domain(dkeys);
  xScale.domain([-10,d3.max(experiments,function(d){return +d.count})]);
    
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(10);
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(dkeys.length);

	var container=svg.append("g").attr("class","parent-to-all");
	 
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("UFO reports")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
			.attr("dy", ".15em")
			.attr("font-size","12px")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx","-.50em")
      .attr("dy", ".80em")
      .style("text-anchor", "end")
      .text("Shapes")
	 ;

var bars=container.append("g")
	     .attr("transform", "translate(40,0)")  
         .selectAll(".gs")
         .data(experiments)
         .enter()
		 .append("g").attr("class","gs");
		 
    bars.selectAll(".bars")
	     .data(experiments)
		 .enter()
	    .append("rect")
	    .attr("class", "bars") 
	    .attr("x",0)
		.attr("y",function(d){ return yScale(d._id)})
        .attr("width",function(d){ return xScale(d.count);})
		.attr("height",4) 
	     .style("fill","steelblue")
		 .on("click",function(d){
		    d3.select(".svg-counts").selectAll(".bars")
            .style("fill", function(d) { return "steelblue"; });                                                
          d3.select(this)
            .style("fill","lightcoral")
            .style("stroke","red");		
		 //console.log(JSON.stringify(d3.select(this)));
		 selected.v1=d3.select(this)[0][0].__data__._id;
		 })
		 .on("mouseover",function(d){
	    	 div1.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div1.html("<span><font face=\"verdana\">Shape: </font>"+d._id+"<br/>"+
		      		 "<font face=\"verdana\">Num Reports: </font>"+d.count+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		;
	 
}

 
function draw_count_charts(chosen_button,experiments)
{
if(chosen_button=="Year")
   draw_Year_chart(experiments);
else if(chosen_button=="Country")
    draw_Country_chart(experiments);
	
else if(chosen_button=="Shape")
    draw_Shape_chart(experiments)

	
	
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////
function Update_chart2()
{
console.log(JSON.stringify(selected));
getMatchStats(selected.b1,selected.v1,selected.b2);

}
function getMatchStats(message,value,m2)
  {
   $.get('http://localhost:3300/UFOreports', function(data) {
        
  // set here your svg properties
                    var data = {};
					data.type="match_counts";
					data.message1=message;
					data.value1=value;
					data.message2=m2;
					//console.log(message);
					$.ajax({
						type: 'POST',
						data: JSON.stringify(data),
				        contentType: 'application/json',
                        url: 'http://localhost:3300/UFOreports',						
                        success: function(resp) {
                            console.log('Getmatch stats success');
   							console.log(JSON.stringify(resp));
							
							
                            draw_Counts2_chart(message,m2,value,resp);                  
				  }
                    });

         });
                   
  }
  
getMatchStats("Year",2012,"Month");

function draw_Counts2_chart(m1,m2,v,experiments)
{
d3.select(".svg-counts2").selectAll(".lines").remove();
	d3.select(".svg-counts2").selectAll(".circles").remove();
	d3.select(".svg-counts2").selectAll(".bars").remove();
	d3.select(".svg-counts2").selectAll(".label").remove();
	d3.select(".svg-counts2").selectAll(".label-text").remove();

if(m1=="Year")
{
draw_YearMC_chart(m2,experiments);
}

else if(m1=="Country")
{
if(m2=="Year")  //line-chart
draw_CountryYear_chart(experiments);
}

else if(m1=="Shape")
{
draw_ShapeYC_chart(m2,experiments); //bubble chart
}

}

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 580 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;
	
   // Adds the svg canvas
   var	svg2 = d3.select(".chart1")
	.append("svg")
	 .attr("class","svg-counts2")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	    .append("g")
		.attr("transform", "translate(" +margin.right+"," +margin.bottom + ")") ;


function draw_ShapeYC_chart(type,experiments)
{

var xScale;

if(type=="Year")
{
experiments.sort(function(a, b) {
    return parseFloat(a._id) - parseFloat(b._id);
});

}

  
  var yScale= d3.scale.linear().range([height, 0]);
  var rScale=d3.scale.linear().range([5,15]);
  
  if(type =="Year")
  {
  xScale= d3.scale.linear().range([0, width-20]);
  xScale.domain([d3.min(experiments,function(d){return +d._id}),d3.max(experiments,function(d){return +d._id})]);
  }
  else if(type =="Country"){
 
  xScale= d3.scale.ordinal().rangePoints([0, width-20]);
  var dkeys=[];
  for (exp in experiments)
  {
  dkeys.push(experiments[exp]._id);
  }  
  
  xScale.domain(dkeys);
  }
  
  yScale.domain([d3.min(experiments,function(d){return +d.count}),d3.max(experiments,function(d){return +d.count})]);
  rScale.domain([d3.min(experiments,function(d){return +d.count}),d3.max(experiments,function(d){return +d.count})]);    
   
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom");
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(20);

   
	var container=svg2.append("g").attr("class","parent-to-all");
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text(type)
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx",".5em")
      .attr("dy", ".8em")
      .style("text-anchor", "end")
      .text("Num reports")
	 ;

	  var c=container.append("g")
	   .attr("transform", "translate(40,0)");
	  
       
	    c.selectAll(".circles")
       .data(experiments)
       .enter()
       .append("circle")
	   .attr("class","circles")
       .attr("r",function(d){return rScale(d.count);})
       .attr("cx",function(d){return xScale(d._id);})
       .attr("cy",function(d){return yScale(d.count);})
 	    .attr("fill","purple")
		.on("click",function(d){ 
          d3.selectAll(".circles")
            .style("fill", function(d) { return "gold"; });                                                
          d3.select(this)
            .style("fill","lightcoral")
            .style("stroke","red");		
	
        })
		.on("mouseover",function(d){
	    	 div1.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div1.html("<span><font face=\"verdana\">"+type+":  </font>"+d._id+"<br/>"+
			
						 "<font face=\"verdana\">Num Reports: </font>"+d.count+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
			 div1.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		;
	  
	   
      
}
		
function draw_CountryYear_chart(experiments)
{

experiments.sort(function(a, b) {
    return parseFloat(a._id) - parseFloat(b._id);
});

  var xScale= d3.scale.linear().range([0, width-20]);
  var yScale= d3.scale.linear().range([height, 0]);
  
  xScale.domain([d3.min(experiments,function(d){return +d._id}),d3.max(experiments,function(d){return +d._id})]);
  yScale.domain([d3.min(experiments,function(d){return +d.count}),d3.max(experiments,function(d){return +d.count})]);
      
   var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(10);
   var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(20);

	var line1 = d3.svg.line()
    .x(function(d,i) { return xScale(d._id); })
    .y(function(d) { return yScale(d.count); });
   
	var container=svg2.append("g").attr("class","parent-to-all");
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Years")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx",".5em")
      .attr("dy", ".8em")
      .style("text-anchor", "end")
      .text("UFO reports")
	 ;

	  var c=container.append("g")
	   .attr("transform", "translate(40,0)");
	    
	   c.append("path")
      .attr("class", "lines")
	  .attr("fill", "none")
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 2.5)
	  .attr("opacity",1)  
       .attr("d",line1(experiments));
      
}	
	
function draw_YearMC_chart(type,experiments)
{ 
if(type=="Month")
{   experiments.sort(function(a, b) {
       return parseFloat(a._id) - parseFloat(b._id);
                  });
}
							 
  var yScale2= d3.scale.ordinal().rangePoints([height,0]);
  var xScale2= d3.scale.linear().range([0, width-20]);
  console.log(JSON.stringify(experiments));
  
  var dkeys=[];
  for (exp in experiments)
  {
  dkeys.push(experiments[exp]._id);
  }
   
  yScale2.domain(dkeys);
  xScale2.domain([-10,d3.max(experiments,function(d){return +d.count})]);
    
   var xAxis2=d3.svg.axis().scale(xScale2).orient("bottom").ticks(10);
   var yAxis2=d3.svg.axis().scale(yScale2).orient("left").ticks(dkeys.length);

	var container=svg2.append("g").attr("class","parent-to-all");
	 
	 // x-axis
   var x=container.append("g")
      .attr("class", "xaxis")
      .attr("transform", "translate(40," + height + ")")
      .call(xAxis2);
	  
	  x.selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", ".8em")
            .attr("dy", ".5em")
			.attr("class","label-text")
           // .attr("transform", "rotate(-5)" );
	  
      x.append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("UFO reports")
	  ; 
  
  // y-axis
 var y= container.append("g")
      .attr("class", "yaxis")
	  .attr("transform", "translate(40,0)")
      .call(yAxis2);
	  
	   y.selectAll("text")  
            .style("text-anchor", "end")
			.attr("class","label-text")
			.attr("dy", ".15em")
			.attr("font-size","12px")
            .attr("transform", "rotate(-5)" );
		   
      y.append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
	  .attr("x",4)
      .attr("y", 5)
	  .attr("dx","-.50em")
      .attr("dy", ".80em")
      .style("text-anchor", "end")
      .text(type)
	 ;

var bars=container.append("g")
	     .attr("transform", "translate(40,0)")  
         .selectAll(".gs")
         .data(experiments)
         .enter()
		 .append("g").attr("class","gs");
		 
    bars.selectAll(".bars")
	     .data(experiments)
		 .enter()
	    .append("rect")
	    .attr("class", "bars") 
	    .attr("x",0)
		.attr("y",function(d){ return yScale2(d._id)})
        .attr("width",function(d){ return xScale2(d.count);})
		.attr("height",4) 
	     .style("fill","steelblue")
		 .on("mouseover",function(d){
	    	 div2.transition()
			    .duration(200)
			    .style("opacity", .9); 
				div2.html("<span><font face=\"verdana\">"+type+":  </font>"+d._id+"<br/>"+
		      		 "<font face=\"verdana\">Num Reports: </font>"+d.count+"<br/></span>")
				.style("left", (d3.event.pageX) + "px")	
				 .style("top", (d3.event.pageY - 28) + "px");
				 })
			
	   .on("mouseout",function(d){
			 div2.transition()
			    .duration(200)
			    .style("opacity", 0); 
			
			})		;
	 
	 
}
 

		
		
</script>

</body>
</html>